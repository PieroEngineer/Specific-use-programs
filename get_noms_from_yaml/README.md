# Mini Project: Name Homologation Between Collected Data and AF Records

This mini-project automates the process of **matching and homologating names** between two datasets:
- **Collected data** (e.g., field measurements or external sources).
- **AF data** (e.g., asset framework records).

It consists of two scripts:

1. **`homologate_names_v2.py`** – Builds a mapping between collected names and AF (An center of data) names based on multiple matching rules and (optionally) saves the homologation dictionary.
2. **`get_noms.py`** – Applies the homologation dictionary to AF data, adds a new column with the homologated names, and exports the updated AF dataset to Excel.

---

## 1) `homologate_names_v2.py`

### What it does
- Loads two Parquet files:
  - `collected_data.parquet` (index: `nombre`).
  - `af_df.parquet` (index: `Elemento`).
- Applies matching rules:
  - Check if `idBarra` from collected data appears in AF index (with exceptions handled via a small dictionary).
  - Compare numeric codes (`Cellcode` vs `IDELEMENT`) with tolerance and prefix checks.
- Builds a dictionary `related_ones` mapping **collected name → AF name**.
- Prints unmatched items and their repetition counts.
- Optionally writes the dictionary to `output/homologated_names_t5.json`.

### Quick start
```bash
python homologate_names_v2.py
```

---

## 2) `get_noms.py`

### What it does
- Loads the same Parquet files as above.
- Reads the homologation dictionary from `output/homologated_names_t5.json`.
- Adds a new column `NOM` to AF data, filling it with homologated names from collected data.
- Exports the updated AF DataFrame to `output/modified_excel_t2.xlsx`.

### Quick start
```bash
python get_noms.py
```

---

## Inputs & Outputs
- **Inputs:**
  - `input/in_parquet/collected_data.parquet`
  - `input/in_parquet/af_df.parquet`
  - `output/homologated_names_t5.json` (generated by the first script)
- **Output:**
  - `output/modified_excel_t2.xlsx` (AF data with homologated names)

---

## Installation

1. Create and activate a virtual environment:
```bash
python -m venv .venv
# Windows
.venv\\Scripts\\activate
# macOS/Linux
source .venv/bin/activate
```

2. Install dependencies:
```bash
pip install -r requirements.txt
```

---

## Suggested structure
```
.
├── homologate_names_v2.py
├── get_noms.py
├── input/
│   └── in_parquet/
│       ├── collected_data.parquet
│       └── af_df.parquet
├── output/
│   ├── homologated_names_t5.json
│   └── modified_excel_t2.xlsx
└── requirements.txt
```

---

## Usage tips
- Adjust `exception_nominations_in_af` for custom name corrections.
- Review numeric tolerance logic if your codes differ significantly.
- Ensure both Parquet files have expected columns: `idBarra`, `Cellcode` (collected); `IDELEMENT`, `NOMBRESUBESTACION` (AF).

---

## Troubleshooting
- **Empty homologation dictionary**: Check matching rules and column names.
- **Export errors**: Ensure output folder exists and you have write permissions.
- **Encoding issues**: Use UTF-8 for Parquet and Excel files.

---

## Credits
- Built by **Piero Olivas**.
